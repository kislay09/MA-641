---
title: "Project Step 5"
author: "Kislay"
date: "2024-04-27"
output:
  pdf_document: default
  html_document:
    df_print: paged
---

```{r setup, include=FALSE}
library(data.table)
library(ggplot2)
library(forecast)
library(tseries)
library(dplyr)
library(zoo)
library(TSA)
```


```{r cars}
data <- read.csv("/Users/kislaynandan/Desktop/MA 641/Electric_Production.csv")
df = data
setDT(data)
df$DateTime <- as.POSIXct(paste(df$DATE), format="%Y-%m-%d")
df$Month = month(df$DateTime)

df$Year = year(df$DateTime)
```


```{r pressure, echo=TRUE}
ts_data <- ts(df$Value, start = min(df$Year), end = max(df$Year), frequency = 12)
plot(ts_data)

```

# Decomposed Data
```{R Press, echo =TRUE}
decomp_result <- decompose(ts_data)
plot(decomp_result)

```


#Stationarity Test
``` {r station, echo=TRUE}
result <- adf.test(ts_data)
result
cat("p-value:", result$p.value)
```

# Data Visualisation
``` {R plot, echo=TRUE}
acf(df$Value, lag.max = 50,
    main = "Autocorrelation Function (ACF) Plot",
    xlab = "Lag", ylab = "ACF")

pacf(df$Value, lag.max = 50,
    main = "Partial Autocorrelation Function (PACF) Plot",
    xlab = "Lag", ylab = "Partial Autocorrelation")

eacf(df$Value)
```

# Model fitting
SARIMA MODEL FITTING

• Because the series is seasonal, SARIMA (Seasonal ARIMA) will be used instead of ARIMA. From ACF and PACF plot below models are chosen to fit to the data:

• Fit 1: SARIMA(5,0,0)(1,0,0)[12]

• Fit 2: SARIMA(4,0,0)(1,0,0)[12]

• Fit 3: SARIMA(3,0,0)(1,0,0)[12]

Since the data is daily, seasonality is 12.

```{R model}
fit <- auto.arima(ts_data)
fit

sarima_model <- Arima(df$Value, order = c(2, 1, 1), seasonal = list(order = c(0, 1, 1), period = 12))

sarima_model
```
```{R}
Arima(df$Value, order = c(5, 0, 0), seasonal = list(order = c(1, 0, 0), period = 12))
Arima(df$Value, order = c(4, 0, 0), seasonal = list(order = c(1, 0, 0), period = 12))
Arima(df$Value, order = c(3, 0, 0), seasonal = list(order = c(1, 0, 0), period = 12))
```


# Residual Analysis
```{r}
residuals <- residuals(fit)
plot(residuals, main="Residuals from ARIMA model")
acf(as.vector(residuals), lag.max = 50)
pacf(as.vector(residuals), lag.max = 50)
qqnorm(residuals)
qqline(residuals)
hist(residuals)
shapiro.test(residuals)
Box.test(residuals,lag=10, type="Ljung-Box")
```
The ACF plot of the residuals shows that most autocorrelations are within the confidence bounds (the blue dotted lines), which is a good indication that the residuals are white noise.
The plot shows most points lie close to the reference line, suggesting that the residuals are approximately normally distributed.
The histogram shows a relatively bell-shaped curve, but it is not perfectly symmetric, and there appears to be a slight skew to the right.
With a p-value of 0.49, which is above the alpha level of 0.05, we fail to reject the null hypothesis that the residuals are independently distributed, meaning there is no autocorrelation.

```{r}
tsdiag(fit)
```

# Prediction
```{r prediction}
predictions <- forecast(sarima_model, h = 12)
predictions

plot(df$Value, type = "l", col = "blue", xlab = "Year", ylab = "Electric Production", main = "Electric Production Forecast using SARIMA")
lines(predictions$mean, col = "red")
legend("topleft", legend = c("Original", "Predictions"), col = c("blue", "red"), lty = c(1, 1))
```


# Non Seasonal Data
``` {r new data, echo=TRUE}
library(data.table)
library(forecast)
library(tseries)
library(lubridate)
library(ggplot2)
library(MASS)
library(TSA)
```
```{r weather, echo=FALSE}
weather <- read.csv("/Users/kislaynandan/Desktop/MA 641/weather_data_nyc_centralpark_2016.csv")
kk = weather
setDT(kk)
kk[,day := as.Date(date, format = "%d-%m-%Y")]
kk[,year := year(date)] 
kk[,mon := month(date)]

mm = kk[, average.temperature, by = .(year, mon)]
tss = ts(mm$average.temperature)
#tss <- ts(mm$average.temperature, start = c(min(mm$year), min(mm$mon)), frequency = 12)
```

```{r plotnew, echo=TRUE}
plot(tss)
acf(tss, main = "Autocorrelation Function (ACF)", lag.max = 80)
pacf(tss, main = "Partial Autocorrelation Function (PACF)",lag.max = 80)
```
The above ACF is decaying/decreasing, very slowly, and remains well above the significance range (dotted blue lines). This is indicative of a non-stationary series.
# Stationarity Test 
``` {r station new, echo=TRUE}
g = as.numeric(tss)
adf.test(g)
```
```{r}
tss_diff = diff(tss)
# Stationarity after differencing 
h = as.numeric(tss_diff) 
adf.test(h)

acf(tss_diff)
pacf(tss_diff)

eacf(tss_diff)
```

# Model fitting
• Model 1: ARIMA(3,1,2) 

• Model 2: ARIMA(2,1,2) 

• Model 3: ARIMA(1,1,1) 

• Model 4: ARIMA(0,1,1)
```{r}
arimafit <- auto.arima(tss)
arimafit
Arima(tss, order = c(3, 1, 2))
Arima(tss, order = c(2, 1, 2))
Arima(tss, order = c(1, 1, 2))

model <- Arima(tss, order = c(1, 1, 2))
model
```

# Residual Analysis
```{r}
arima_residuals <- residuals(model)
plot(arima_residuals, main = "Residuals from ARIMA Model", ylab = "Residuals")
acf(as.vector(arima_residuals), lag.max = 50)
pacf(as.vector(arima_residuals), lag.max = 50)
qqnorm(arima_residuals)
qqline(arima_residuals)
hist(arima_residuals)
print(shapiro.test(arima_residuals))
ljung_box_test <- Box.test(arima_residuals, lag = 10, type = "Ljung-Box")
ljung_box_test
```

```{r}
tsdiag(model)
```

# Prediction
```{r}
forecast_best_model <- forecast(model, h = 12)
forecast_best_model
plot(forecast_best_model, col="red", main = "ARIMA Forecast")
```

